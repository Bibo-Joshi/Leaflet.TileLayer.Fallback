{"version":3,"file":"leaflet.tilelayer.fallback-src.js","sources":["src/fallback.js"],"sourcesContent":["var TL = L.TileLayer,\n    TLproto = TL.prototype;\n\n\nvar FallbackTileLayer = TL.extend({\n\n\toptions: {\n\t\tminNativeZoom: 0\n\t},\n\n\tinitialize: function (urlTemplate, options) {\n\t\tTLproto.initialize.call(this, urlTemplate, options);\n\t},\n\n\t_loadTile: function (tile, tilePoint) {\n\t\tTLproto._loadTile.call(this, tile, tilePoint);\n\t\ttile._originalTilePoint = tilePoint;\n\t\ttile._originalSrc = tile.src;\n\t},\n\n\t_tileOnError: function () {\n\t\tvar layer = this._layer,\n\t\t    originalTilePoint = this._originalTilePoint,\n\t\t    tilePoint = this._tilePoint = this._tilePoint || L.extend({}, originalTilePoint),\n\t\t    fallbackZoom = this._fallbackZoom = (this._fallbackZoom || originalTilePoint.z) - 1,\n\t\t    scale = this._fallbackScale = (this._fallbackScale || 1) * 2,\n\t\t    tileSize = layer._getTileSize(),\n\t\t    newUrl, top, left;\n\n\t\t// If no lower zoom tiles are available, fallback to errorTile.\n\t\tif (fallbackZoom < layer.options.minNativeZoom) {\n\t\t\tlayer.fire('tileerror', {\n\t\t\t\ttile: this,\n\t\t\t\turl: this.src\n\t\t\t});\n\n\t\t\tnewUrl = layer.options.errorTileUrl;\n\t\t\tif (newUrl) {\n\t\t\t\tthis.src = newUrl;\n\t\t\t}\n\n\t\t\tlayer._tileLoaded();\n\t\t\treturn;\n\t\t}\n\n\t\t// Modify tilePoint for replacement img.\n\t\ttilePoint.z = fallbackZoom;\n\t\ttilePoint.x = Math.floor(tilePoint.x / 2);\n\t\ttilePoint.y = Math.floor(tilePoint.y / 2);\n\n\t\t// Generate new src path.\n\t\tnewUrl = layer.getTileUrl(tilePoint);\n\n\t\t// Zoom replacement img.\n\t\tthis.style.width = this.style.height = (tileSize * scale) + 'px';\n\n\t\t// Compute margins to adjust position.\n\t\ttop = (originalTilePoint.y - tilePoint.y * scale) * tileSize;\n\t\tthis.style.marginTop = (-top) + 'px';\n\t\tleft = (originalTilePoint.x - tilePoint.x * scale) * tileSize;\n\t\tthis.style.marginLeft = (-left) + 'px';\n\n\t\t// Crop (clip) image.\n\t\t// `clip` is deprecated, but browsers support for `clip-path: inset()` is far behind.\n\t\t// http://caniuse.com/#feat=css-clip-path\n\t\tthis.style.clip = 'rect(' + top + 'px ' + (left + tileSize) + 'px ' + (top + tileSize) + 'px ' + left + 'px)';\n\n\t\tlayer.fire('tilefallback', {\n\t\t\ttile: this,\n\t\t\turl: this._originalSrc,\n\t\t\turlMissing: this.src,\n\t\t\turlFallback: newUrl\n\t\t});\n\n\t\tthis.src = newUrl;\n\t},\n\n\t_resetTile: function (tile) {\n\t\tvar tileSize = this._getTileSize() + 'px';\n\n\t\tdelete tile._originalTilePoint;\n\t\tdelete tile._fallbackZoom;\n\t\tdelete tile._fallbackScale;\n\t\ttile.style = {\n\t\t\twidth: tileSize,\n\t\t\theight: tileSize\n\t\t};\n\t}\n\n});\n\n\n\n// Supply with a factory for consistency with Leaflet.\nL.tileLayer.fallback = function (urlTemplate, options) {\n\treturn new FallbackTileLayer(urlTemplate, options);\n};\n\n\n\n"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAAA;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;,;;;;"}